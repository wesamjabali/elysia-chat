// @bun
var W$=Object.create;var{defineProperty:G1,getPrototypeOf:J$,getOwnPropertyNames:Z$}=Object;var X$=Object.prototype.hasOwnProperty;var R0=($,W,J)=>{J=$!=null?W$(J$($)):{};const Z=W||!$||!$.__esModule?G1(J,"default",{value:$,enumerable:!0}):J;for(let X of Z$($))if(!X$.call(Z,X))G1(Z,X,{get:()=>$[X],enumerable:!0});return Z};var X0=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports);var I1=X0((k$,l0)=>{var K0=function(){},Y$=function($,W,J){this.fn=$,this.context=W,this.once=J||!1},U1=function($,W,J,Z,X){if(typeof J!=="function")throw new TypeError("The listener must be a function");var B=new Y$(J,Z||$,X),Y=f?f+W:W;if(!$._events[Y])$._events[Y]=B,$._eventsCount++;else if(!$._events[Y].fn)$._events[Y].push(B);else $._events[Y]=[$._events[Y],B];return $},E0=function($,W){if(--$._eventsCount===0)$._events=new K0;else delete $._events[W]},g=function(){this._events=new K0,this._eventsCount=0},B$=Object.prototype.hasOwnProperty,f="~";if(Object.create){if(K0.prototype=Object.create(null),!new K0().__proto__)f=!1}g.prototype.eventNames=function $(){var W=[],J,Z;if(this._eventsCount===0)return W;for(Z in J=this._events)if(B$.call(J,Z))W.push(f?Z.slice(1):Z);if(Object.getOwnPropertySymbols)return W.concat(Object.getOwnPropertySymbols(J));return W};g.prototype.listeners=function $(W){var J=f?f+W:W,Z=this._events[J];if(!Z)return[];if(Z.fn)return[Z.fn];for(var X=0,B=Z.length,Y=new Array(B);X<B;X++)Y[X]=Z[X].fn;return Y};g.prototype.listenerCount=function $(W){var J=f?f+W:W,Z=this._events[J];if(!Z)return 0;if(Z.fn)return 1;return Z.length};g.prototype.emit=function $(W,J,Z,X,B,Y){var D=f?f+W:W;if(!this._events[D])return!1;var Q=this._events[D],z=arguments.length,G,U;if(Q.fn){if(Q.once)this.removeListener(W,Q.fn,void 0,!0);switch(z){case 1:return Q.fn.call(Q.context),!0;case 2:return Q.fn.call(Q.context,J),!0;case 3:return Q.fn.call(Q.context,J,Z),!0;case 4:return Q.fn.call(Q.context,J,Z,X),!0;case 5:return Q.fn.call(Q.context,J,Z,X,B),!0;case 6:return Q.fn.call(Q.context,J,Z,X,B,Y),!0}for(U=1,G=new Array(z-1);U<z;U++)G[U-1]=arguments[U];Q.fn.apply(Q.context,G)}else{var T=Q.length,j;for(U=0;U<T;U++){if(Q[U].once)this.removeListener(W,Q[U].fn,void 0,!0);switch(z){case 1:Q[U].fn.call(Q[U].context);break;case 2:Q[U].fn.call(Q[U].context,J);break;case 3:Q[U].fn.call(Q[U].context,J,Z);break;case 4:Q[U].fn.call(Q[U].context,J,Z,X);break;default:if(!G)for(j=1,G=new Array(z-1);j<z;j++)G[j-1]=arguments[j];Q[U].fn.apply(Q[U].context,G)}}}return!0};g.prototype.on=function $(W,J,Z){return U1(this,W,J,Z,!1)};g.prototype.once=function $(W,J,Z){return U1(this,W,J,Z,!0)};g.prototype.removeListener=function $(W,J,Z,X){var B=f?f+W:W;if(!this._events[B])return this;if(!J)return E0(this,B),this;var Y=this._events[B];if(Y.fn){if(Y.fn===J&&(!X||Y.once)&&(!Z||Y.context===Z))E0(this,B)}else{for(var D=0,Q=[],z=Y.length;D<z;D++)if(Y[D].fn!==J||X&&!Y[D].once||Z&&Y[D].context!==Z)Q.push(Y[D]);if(Q.length)this._events[B]=Q.length===1?Q[0]:Q;else E0(this,B)}return this};g.prototype.removeAllListeners=function $(W){var J;if(W){if(J=f?f+W:W,this._events[J])E0(this,J)}else this._events=new K0,this._eventsCount=0;return this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prefixed=f;g.EventEmitter=g;if(typeof l0!=="undefined")l0.exports=g});var J1=X0((_W,R1)=>{var j$=function($){var W=$.indexOf("%");if(W===-1)return $;var J=$.length,Z="",X=0,B=0,Y=W,D=w1;while(W>-1&&W<J){var Q=C1($[W+1],4),z=C1($[W+2],0),G=Q|z,U=W1[G];if(D=W1[256+D+U],B=B<<6|G&W1[364+U],D===w1)Z+=$.slice(X,Y),Z+=B<=65535?String.fromCharCode(B):String.fromCharCode(55232+(B>>10),56320+(B&1023)),B=0,X=W+3,W=Y=$.indexOf("%",X);else if(D===F$)return null;else{if(W+=3,W<J&&$.charCodeAt(W)===37)continue;return null}}return Z+$.slice(X)},C1=function($,W){var J=P$[$];return J===void 0?255:J<<W},w1=12,F$=0,W1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],P$={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};R1.exports=j$});var x1=X0((GW,L1)=>{var T$=function($){const W=new b1;if(typeof $!=="string")return W;let J=$.length,Z="",X="",B=-1,Y=-1,D=!1,Q=!1,z=!1,G=!1,U=!1,T=0;for(let j=0;j<J+1;j++)if(T=j!==J?$.charCodeAt(j):38,T===38){if(U=Y>B,!U)Y=j;if(Z=$.slice(B+1,Y),U||Z.length>0){if(z)Z=Z.replace(H1," ");if(D)Z=E1(Z)||Z;if(U){if(X=$.slice(Y+1,j),G)X=X.replace(H1," ");if(Q)X=E1(X)||X}const K=W[Z];if(K===void 0)W[Z]=X;else if(K.pop)K.push(X);else W[Z]=[K,X]}X="",B=j,Y=j,D=!1,Q=!1,z=!1,G=!1}else if(T===61)if(Y<=B)Y=j;else Q=!0;else if(T===43)if(Y>B)G=!0;else z=!0;else if(T===37)if(Y>B)Q=!0;else D=!0;return W},E1=J1(),H1=/\+/g,b1=function(){};b1.prototype=Object.create(null);L1.exports=T$});var f1=X0((zW,g1)=>{var S$=function($){const W=$.length;if(W===0)return"";let J="",Z=0,X=0;$:for(;X<W;X++){let B=$.charCodeAt(X);while(B<128){if(V$[B]!==1){if(Z<X)J+=$.slice(Z,X);Z=X+1,J+=l[B]}if(++X===W)break $;B=$.charCodeAt(X)}if(Z<X)J+=$.slice(Z,X);if(B<2048){Z=X+1,J+=l[192|B>>6]+l[128|B&63];continue}if(B<55296||B>=57344){Z=X+1,J+=l[224|B>>12]+l[128|B>>6&63]+l[128|B&63];continue}if(++X,X>=W)throw new Error("URI malformed");const Y=$.charCodeAt(X)&1023;Z=X+1,B=65536+((B&1023)<<10|Y),J+=l[240|B>>18]+l[128|B>>12&63]+l[128|B>>6&63]+l[128|B&63]}if(Z===0)return $;if(Z<W)return J+$.slice(Z);return J},l=Array.from({length:256},($,W)=>"%"+((W<16?"0":"")+W.toString(16)).toUpperCase()),V$=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);g1.exports={encodeString:S$}});var k1=X0((KW,v1)=>{var y1=function($){const W=typeof $;if(W==="string")return Z1($);else if(W==="bigint")return $.toString();else if(W==="boolean")return $?"true":"false";else if(W==="number"&&Number.isFinite($))return $<1000000000000000000000?""+$:Z1(""+$);return""},q$=function($){let W="";if($===null||typeof $!=="object")return W;const J="&",Z=Object.keys($),X=Z.length;let B=0;for(let Y=0;Y<X;Y++){const D=Z[Y],Q=$[D],z=Z1(D)+"=";if(Y)W+=J;if(Array.isArray(Q)){B=Q.length;for(let G=0;G<B;G++){if(G)W+=J;W+=z,W+=y1(Q[G])}}else W+=z,W+=y1(Q)}return W},{encodeString:Z1}=f1();v1.exports=q$});var X1=X0((UW,F0)=>{var m1=x1(),u1=k1(),h1={parse:m1,stringify:u1};F0.exports=h1;F0.exports.default=h1;F0.exports.parse=m1;F0.exports.stringify=u1});var B0=($,W)=>({part:$,store:null,inert:W!==void 0?new Map(W.map((J)=>[J.part.charCodeAt(0),J])):null,params:null,wildcardStore:null}),z1=($,W)=>({...$,part:W}),K1=($)=>({paramName:$,store:null,inert:null});class s{root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g};add($,W,J){let Z;if(typeof W!="string")throw TypeError("Route path must be a string");W===""?W="/":W[0]!=="/"&&(W=`/${W}`),this.history.push([$,W,J]);let X=W[W.length-1]==="*";X&&(W=W.slice(0,-1));let B=W.split(s.regex.static),Y=W.match(s.regex.params)||[];B[B.length-1]===""&&B.pop(),Z=this.root[$]?this.root[$]:this.root[$]=B0("/");let D=0;for(let Q=0;Q<B.length;++Q){let z=B[Q];if(Q>0){let G=Y[D++].slice(1);if(Z.params===null)Z.params=K1(G);else if(Z.params.paramName!==G)throw Error(`Cannot create route "${W}" with parameter "${G}" because a route already exists with a different parameter name ("${Z.params.paramName}") in the same location`);let U=Z.params;if(U.inert===null){Z=U.inert=B0(z);continue}Z=U.inert}for(let G=0;;){if(G===z.length){if(G<Z.part.length){let U=z1(Z,Z.part.slice(G));Object.assign(Z,B0(z,[U]))}break}if(G===Z.part.length){if(Z.inert===null)Z.inert=new Map;else if(Z.inert.has(z.charCodeAt(G))){Z=Z.inert.get(z.charCodeAt(G)),z=z.slice(G),G=0;continue}let U=B0(z.slice(G));Z.inert.set(z.charCodeAt(G),U),Z=U;break}if(z[G]!==Z.part[G]){let U=z1(Z,Z.part.slice(G)),T=B0(z.slice(G));Object.assign(Z,B0(Z.part.slice(0,G),[U,T])),Z=T;break}++G}}if(D<Y.length){let Q=Y[D],z=Q.slice(1);if(Z.params===null)Z.params=K1(z);else if(Z.params.paramName!==z)throw Error(`Cannot create route "${W}" with parameter "${z}" because a route already exists with a different parameter name ("${Z.params.paramName}") in the same location`);return Z.params.store===null&&(Z.params.store=J),Z.params.store}return X?(Z.wildcardStore===null&&(Z.wildcardStore=J),Z.wildcardStore):(Z.store===null&&(Z.store=J),Z.store)}find($,W){let J=this.root[$];return J?p0(W,W.length,J,0):null}}var p0=($,W,J,Z)=>{let X=J?.part,B=Z+X.length;if(X.length>1){if(B>W)return null;if(X.length<15){for(let Y=1,D=Z+1;Y<X.length;++Y,++D)if(X.charCodeAt(Y)!==$.charCodeAt(D))return null}else if($.substring(Z,B)!==X)return null}if(B===W)return J.store!==null?{store:J.store,params:{}}:J.wildcardStore!==null?{store:J.wildcardStore,params:{"*":""}}:null;if(J.inert!==null){let Y=J.inert.get($.charCodeAt(B));if(Y!==void 0){let D=p0($,W,Y,B);if(D!==null)return D}}if(J.params!==null){let Y=J.params,D=$.indexOf("/",B);if(D!==B){if(D===-1||D>=W){if(Y.store!==null){let Q={};return Q[Y.paramName]=$.substring(B,W),{store:Y.store,params:Q}}}else if(Y.inert!==null){let Q=p0($,W,Y.inert,D);if(Q!==null)return Q.params[Y.paramName]=$.substring(B,D),Q}}}return J.wildcardStore!==null?{store:J.wildcardStore,params:{"*":$.substring(B,W)}}:null};var M1=R0(I1(),1);var O1=M1.default;var H0=()=>{let $;return[new Promise((J)=>{$=J}),$]},t=()=>{const[$,W]=H0(),[J,Z]=H0(),X=[],B=[];return{signal:$,consume:(Y)=>{switch(Y.type){case"begin":if(Y.unit&&X.length===0)for(let D=0;D<Y.unit;D++){const[Q,z]=H0(),[G,U]=H0();X.push(Q),B.push([(T)=>{z({children:[],end:G,name:T.name??"",skip:!1,time:T.time})},(T)=>{U(T)}])}W({children:X,end:J,name:Y.name??"",skip:!1,time:Y.time});break;case"end":Z(Y.time);break}},consumeChild(Y){switch(Y.type){case"begin":if(!B[0])return;const[D]=B[0];D({children:[],end:J,name:Y.name??"",skip:!1,time:Y.time});break;case"end":const Q=B.shift();if(!Q)return;Q[1](Y.time)}},resolve(){W({children:[],end:new Promise((Y)=>Y(0)),name:"",skip:!0,time:0});for(let[Y,D]of B)Y({children:[],end:new Promise((Q)=>Q(0)),name:"",skip:!0,time:0}),D(0);Z(0)}}},A1=($,W,J)=>{return async function Z(Z){if(Z.event!=="request"||Z.type!=="begin")return;const X=Z.id,B=$(),Y=t(),D=t(),Q=t(),z=t(),G=t(),U=t(),T=t(),j=t();Y.consume(Z);const K=(P)=>{if(P.id===X)switch(P.event){case"request":Y.consume(P);break;case"request.unit":Y.consumeChild(P);break;case"parse":D.consume(P);break;case"parse.unit":D.consumeChild(P);break;case"transform":Q.consume(P);break;case"transform.unit":Q.consumeChild(P);break;case"beforeHandle":z.consume(P);break;case"beforeHandle.unit":z.consumeChild(P);break;case"handle":G.consume(P);break;case"afterHandle":U.consume(P);break;case"afterHandle.unit":U.consumeChild(P);break;case"error":T.consume(P);break;case"error.unit":T.consumeChild(P);break;case"response":if(P.type==="begin")Y.resolve(),D.resolve(),Q.resolve(),z.resolve(),G.resolve(),U.resolve(),T.resolve();else B.off("event",K);j.consume(P);break;case"response.unit":j.consumeChild(P);break;case"exit":Y.resolve(),D.resolve(),Q.resolve(),z.resolve(),G.resolve(),U.resolve(),T.resolve();break}};B.on("event",K),await J({id:X,context:Z.ctx,set:Z.ctx?.set,store:Z.ctx?.store,time:Z.time,request:Y.signal,parse:D.signal,transform:Q.signal,beforeHandle:z.signal,handle:G.signal,afterHandle:U.signal,error:T.signal,response:j.signal}),B.emit(`res${X}.${W}`,void 0)}};import{Value as e0} from"@sinclair/typebox/value";import{Kind as n0} from"@sinclair/typebox";import{Value as y0} from"@sinclair/typebox/value";import{TypeCompiler as P1} from"@sinclair/typebox/compiler";var D$=function($,W){if(typeof $!=="string")throw new TypeError("argument str must be a string");var J={},Z=W||{},X=Z.decode||G$,B=0;while(B<$.length){var Y=$.indexOf("=",B);if(Y===-1)break;var D=$.indexOf(";",B);if(D===-1)D=$.length;else if(D<Y){B=$.lastIndexOf(";",Y-1)+1;continue}var Q=$.slice(B,Y).trim();if(J[Q]===void 0){var z=$.slice(Y+1,D).trim();if(z.charCodeAt(0)===34)z=z.slice(1,-1);J[Q]=U$(z,X)}B=D+1}return J},_$=function($,W,J){var Z=J||{},X=Z.encode||z$;if(typeof X!=="function")throw new TypeError("option encode is invalid");if(!b0.test($))throw new TypeError("argument name is invalid");var B=X(W);if(B&&!b0.test(B))throw new TypeError("argument val is invalid");var Y=$+"="+B;if(Z.maxAge!=null){var D=Z.maxAge-0;if(isNaN(D)||!isFinite(D))throw new TypeError("option maxAge is invalid");Y+="; Max-Age="+Math.floor(D)}if(Z.domain){if(!b0.test(Z.domain))throw new TypeError("option domain is invalid");Y+="; Domain="+Z.domain}if(Z.path){if(!b0.test(Z.path))throw new TypeError("option path is invalid");Y+="; Path="+Z.path}if(Z.expires){var Q=Z.expires;if(!K$(Q)||isNaN(Q.valueOf()))throw new TypeError("option expires is invalid");Y+="; Expires="+Q.toUTCString()}if(Z.httpOnly)Y+="; HttpOnly";if(Z.secure)Y+="; Secure";if(Z.partitioned)Y+="; Partitioned";if(Z.priority){var z=typeof Z.priority==="string"?Z.priority.toLowerCase():Z.priority;switch(z){case"low":Y+="; Priority=Low";break;case"medium":Y+="; Priority=Medium";break;case"high":Y+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(Z.sameSite){var G=typeof Z.sameSite==="string"?Z.sameSite.toLowerCase():Z.sameSite;switch(G){case!0:Y+="; SameSite=Strict";break;case"lax":Y+="; SameSite=Lax";break;case"strict":Y+="; SameSite=Strict";break;case"none":Y+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return Y},G$=function($){return $.indexOf("%")!==-1?decodeURIComponent($):$},z$=function($){return encodeURIComponent($)},K$=function($){return Q$.call($)==="[object Date]"||$ instanceof Date},U$=function($,W){try{return W($)}catch(J){return $}};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var L0=D$,x0=_$;var Q$=Object.prototype.toString,b0=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;class m{$;W;name;setter;constructor($,W={}){this._value=$;this.property=W}get(){return this._value}get value(){return this._value}set value($){if(typeof $==="object"){if(JSON.stringify(this.value)===JSON.stringify($))return}else if(this.value===$)return;this._value=$,this.sync()}add($){const W=Object.assign(this.property,typeof $==="function"?$(Object.assign(this.property,this.value)):$);if("value"in W)this._value=W.value,delete W.value;return this.property=W,this.sync()}set($){const W=typeof $==="function"?$(Object.assign(this.property,this.value)):$;if("value"in W)this._value=W.value,delete W.value;return this.property=W,this.sync()}remove($){if(this.value===void 0)return;this.set({domain:$?.domain,expires:new Date(0),maxAge:0,path:$?.path,sameSite:$?.sameSite,secure:$?.secure,value:""})}get domain(){return this.property.domain}set domain($){if(this.property.domain===$)return;this.property.domain=$,this.sync()}get expires(){return this.property.expires}set expires($){if(this.property.expires?.getTime()===$?.getTime())return;this.property.expires=$,this.sync()}get httpOnly(){return this.property.httpOnly}set httpOnly($){if(this.property.domain===$)return;this.property.httpOnly=$,this.sync()}get maxAge(){return this.property.maxAge}set maxAge($){if(this.property.maxAge===$)return;this.property.maxAge=$,this.sync()}get path(){return this.property.path}set path($){if(this.property.path===$)return;this.property.path=$,this.sync()}get priority(){return this.property.priority}set priority($){if(this.property.priority===$)return;this.property.priority=$,this.sync()}get sameSite(){return this.property.sameSite}set sameSite($){if(this.property.sameSite===$)return;this.property.sameSite=$,this.sync()}get secure(){return this.property.secure}set secure($){if(this.property.secure===$)return;this.property.secure=$,this.sync()}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}sync(){if(!this.name||!this.setter)return this;if(!this.setter.cookie)this.setter.cookie={[this.name]:Object.assign(this.property,{value:this.toString()})};else this.setter.cookie[this.name]=Object.assign(this.property,{value:this.toString()});return this}}var N1=($,W,J)=>new Proxy($,{get(Z,X){if(X in Z)return Z[X];const B=new m(void 0,J?{...J}:void 0);return B.setter=W,B.name=X,B},set(Z,X,B){if(!(B instanceof m))return!1;if(!W.cookie)W.cookie={};return B.setter=W,B.name=X,B.sync(),Z[X]=B,!0}}),g0=async($,W,{secret:J,sign:Z,...X}={})=>{if(!W)return N1({},$,X);const B={},Y=typeof J==="string";if(Z&&Z!==!0&&!Array.isArray(Z))Z=[Z];const D=Object.keys(L0(W));for(let Q=0;Q<D.length;Q++){const z=D[Q];let G=L0(W)[z];if(Z===!0||Z?.includes(z)){if(!J)throw new Error("No secret is provided to cookie plugin");if(Y){if(G=await i0(G,J),G===!1)throw new U0(z)}else{let j=!0;for(let K=0;K<J.length;K++){const P=await i0(G,J[K]);if(P!==!1){G=P,j=!1;break}}if(j)throw new U0(z)}}if(G===void 0)continue;const U=G.charCodeAt(0);if(U===123||U===91)try{const j=new m(JSON.parse(G));j.setter=$,j.name=z,B[z]=j;continue}catch{}if(f0(G))G=+G;else if(G==="true")G=!0;else if(G==="false")G=!1;const T=new m(G,X);T.setter=$,T.name=z,B[z]=T}return N1(B,$)};var I0="toJSON"in new Headers,u=($)=>{for(let W in $)return!0;return!1},M0=($,W)=>{const J=$.size;if(J&&W&&W.status!==206&&W.status!==304&&W.status!==412&&W.status!==416||!W&&J){if(W){if(W.headers instanceof Headers){if(I0)W.headers=W.headers.toJSON();else for(let[Z,X]of W.headers.entries())if(Z in W.headers)W.headers[Z]=X}return new Response($,{status:W.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${J-1}/${J}`},W.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${J-1}/${J}`}})}return new Response($)},F1=($,W)=>{if(!$||!Array.isArray(W))return $;$.delete("Set-Cookie");for(let J=0;J<W.length;J++){const Z=W[J].indexOf("=");$.append("Set-Cookie",`${W[J].slice(0,Z)}=${W[J].slice(Z+1)}`)}return $},j1=($)=>{if(!$||typeof $!=="object"||!u($))return;const W=[];for(let[J,Z]of Object.entries($)){if(!J||!Z)continue;if(Array.isArray(Z.value))for(let X=0;X<Z.value.length;X++){let B=Z.value[X];if(B===void 0||B===null)continue;if(typeof B==="object")B=JSON.stringify(B);W.push(x0(J,B,Z))}else{let X=Z.value;if(X===void 0||X===null)continue;if(typeof X==="object")X=JSON.stringify(X);W.push(x0(J,Z.value,Z))}}if(W.length===0)return;if(W.length===1)return W[0];return W},v=($,W)=>{if($?.[$.$passthrough])$=$[$.$passthrough];if($?.[c])W.status=$[c],$=$.response;if(u(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=O0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&u(W.cookie))W.headers["Set-Cookie"]=j1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=F1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return M0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,W);case void 0:if(!$)return new Response("",W);return Response.json($,W);case"Response":const J={...W.headers};if(I0)W.headers=$.headers.toJSON();else for(let[X,B]of $.headers.entries())if(X in W.headers)W.headers[X]=B;for(let X in J)$.headers.append(X,J[X]);return $;case"Error":return h($,W);case"Promise":return $.then((X)=>v(X,W));case"Function":return v($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof m)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const X={...W.headers};if(I0)W.headers=$.headers.toJSON();else for(let[B,Y]of $.headers.entries())if(B in W.headers)W.headers[B]=Y;for(let B in X)$.headers.append(B,X[B]);return $}if($ instanceof Promise)return $.then((X)=>v(X,W));if($ instanceof Error)return h($,W);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}return new Response(Z,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return M0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($,W);case"Promise":return $.then((Z)=>{const X=i(Z);if(X!==void 0)return X;return new Response("")});case"Function":return i($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof m)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((Z)=>v(Z,W));if($ instanceof Error)return h($,W);const J=JSON.stringify($);if(J.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(J)}},y=($,W)=>{if($===void 0||$===null)return;if($?.$passthrough)$=$[$.$passthrough];if($?.[c])W.status=$[c],$=$.response;if(u(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=O0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&u(W.cookie))W.headers["Set-Cookie"]=j1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=F1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return M0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,W);case void 0:if(!$)return;return Response.json($,W);case"Response":const J=Object.assign({},W.headers);if(I0)W.headers=$.headers.toJSON();else for(let[X,B]of $.headers.entries())if(!(X in W.headers))W.headers[X]=B;for(let X in J)$.headers.append(X,J[X]);if($.status!==W.status)W.status=$.status;return $;case"Promise":return $.then((X)=>{const B=y(X,W);if(B!==void 0)return B;return});case"Error":return h($,W);case"Function":return y($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof m)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const X={...W.headers};if(I0)W.headers=$.headers.toJSON();else for(let[B,Y]of $.headers.entries())if(B in W.headers)W.headers[B]=Y;for(let B in X)$.headers.append(B,X[B]);return $}if($ instanceof Promise)return $.then((X)=>y(X,W));if($ instanceof Error)return h($,W);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}return new Response(Z,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return M0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Promise":return $.then((Z)=>{const X=y(Z,W);if(X!==void 0)return X;return});case"Error":return h($,W);case"Function":return i($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof m)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((Z)=>y(Z,W));if($ instanceof Error)return h($,W);const J=JSON.stringify($);if(J.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(J)}},i=($)=>{if($?.$passthrough)$=$[$.$passthrough];if($?.[c])return v($.response,{status:$[c],headers:{}});switch($?.constructor?.name){case"String":return new Response($);case"Blob":return M0($);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($);case"Promise":return $.then(i);case"Function":return i($());case"Number":case"Boolean":return new Response($.toString());default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then(i);if($ instanceof Error)return h($);const W=JSON.stringify($);if(W.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(W)}},h=($,W)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:W?.status!==200?W?.status??500:500,headers:W?.headers});var r0=($)=>$&&typeof $==="object"&&!Array.isArray($),t0=($,W)=>{const J=new URL($);return J.pathname=W,J.toString()},I$=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")||u(Object.getPrototypeOf($)),d=($,W,{skipKeys:J}={})=>{if(r0($)&&r0(W))for(let[Z,X]of Object.entries(W)){if(J?.includes(Z))continue;if(!r0(X)){$[Z]=X;continue}if(!(Z in $)){$[Z]=X;continue}if(I$(X)){$[Z]=X;continue}$[Z]=d($[Z],X)}return $},T1=($,W)=>d($,W,{skipKeys:["properties"]}),H=($,W)=>{if(!$)return[];const J=[...Array.isArray($)?$:[$]],Z=[];for(let X of J)if(X.$elysiaChecksum)Z.push(X.$elysiaChecksum);for(let X of Array.isArray(W)?W:[W])if(!Z.includes(X?.$elysiaChecksum))J.push(X);return J},M$=["start","request","parse","transform","resolve","beforeHandle","afterHandle","onResponse","mapResponse","trace","error","stop","body","headers","params","query","response","type","detail"],a=($,W)=>{return{...$,...W,body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,response:W?.response??$?.response,type:$?.type||W?.type,detail:d(W?.detail??{},$?.detail??{}),parse:H($?.parse??[],W?.parse??[]),transform:H($?.transform??[],W?.transform??[]),beforeHandle:H($?.beforeHandle??[],W?.beforeHandle??[]),afterHandle:H($?.afterHandle??[],W?.afterHandle??[]),onResponse:H($?.onResponse??[],W?.onResponse??[]),mapResponse:H($?.mapResponse??[],W?.mapResponse??[]),trace:H($?.trace??[],W?.trace??[]),error:H($?.error??[],W?.error??[])}},p=($,{models:W={},additionalProperties:J=!1,dynamic:Z=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const X=typeof $==="string"?W[$]:$;if(X.type==="object"&&"additionalProperties"in X===!1)X.additionalProperties=J;if(Z)return{schema:X,references:"",checkFunc:()=>{},code:"",Check:(B)=>y0.Check(X,B),Errors:(B)=>y0.Errors(X,B),Code:()=>""};return P1.Compile(X,Object.values(W))},a0=($,{models:W={},additionalProperties:J=!1,dynamic:Z=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const X=typeof $==="string"?W[$]:$,B=(D,Q)=>{if(Z)return{schema:D,references:"",checkFunc:()=>{},code:"",Check:(z)=>y0.Check(D,z),Errors:(z)=>y0.Errors(D,z),Code:()=>""};return P1.Compile(D,Q)};if(n0 in X){if("additionalProperties"in X===!1)X.additionalProperties=J;return{200:B(X,Object.values(W))}}const Y={};return Object.keys(X).forEach((D)=>{const Q=X[+D];if(typeof Q==="string"){if(Q in W){const z=W[Q];z.type==="object"&&"additionalProperties"in z,Y[+D]=n0 in z?B(z,Object.values(W)):z}return}if(Q.type==="object"&&"additionalProperties"in Q===!1)Q.additionalProperties=J;Y[+D]=n0 in Q?B(Q,Object.values(W)):Q}),Y},O$=typeof Bun!=="undefined",A$=O$&&typeof Bun.hash==="function",A0=($)=>{if(A$)return Bun.hash($);let W=9;for(let J=0;J<$.length;)W=Math.imul(W^$.charCodeAt(J++),387420489);return W=W^W>>>9},v0=($,W,J)=>{const Z=(X)=>{if(J&&!X.$elysiaChecksum)X.$elysiaChecksum=J;return X};return{...$,...W,start:H($.start,("start"in W?W.start??[]:[]).map(Z)),request:H($.request,("request"in W?W.request??[]:[]).map(Z)),parse:H($.parse,"parse"in W?W?.parse??[]:[]).map(Z),transform:H($.transform,(W?.transform??[]).map(Z)),beforeHandle:H($.beforeHandle,(W?.beforeHandle??[]).map(Z)),afterHandle:H($.afterHandle,(W?.afterHandle??[]).map(Z)),mapResponse:H($.mapResponse,(W?.mapResponse??[]).map(Z)),onResponse:H($.onResponse,(W?.onResponse??[]).map(Z)),trace:$.trace,error:H($.error,(W?.error??[]).map(Z)),stop:H($.stop,("stop"in W?W.stop??[]:[]).map(Z))}};var V1=($,W=!0)=>{if(!$)return $;if(typeof $==="function"){if(W)$.$elysiaHookType="global";else $.$elysiaHookType=void 0;return $}return $.map((J)=>{if(W)J.$elysiaHookType="global";else J.$elysiaHookType=void 0;return J})},Y0=($)=>{if(!$)return $;if(typeof $==="function")return $.$elysiaHookType==="global"?$:void 0;return $.filter((W)=>W.$elysiaHookType==="global")},s0=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:Y0($?.parse),transform:Y0($?.transform),beforeHandle:Y0($?.beforeHandle),afterHandle:Y0($?.afterHandle),onResponse:Y0($?.onResponse),error:Y0($?.error)}},O0={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},Q0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(W===null)throw new TypeError("Secret key must be provided.");const J=new TextEncoder,Z=await crypto.subtle.importKey("raw",J.encode(W),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),X=await crypto.subtle.sign("HMAC",Z,J.encode($)),B=Array.from(new Uint8Array(X)),Y=btoa(String.fromCharCode(...B));return`${$}.${Y.replace(/=+$/,"")}`},i0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(W===null)throw new TypeError("Secret key must be provided.");const J=$.slice(0,$.lastIndexOf("."));return await Q0(J,W)===$?J:!1},o0=($,W,J=W)=>{for(let[Z,X]of Object.entries(W??{})){if(M$.includes(Z)||!(Z in $))continue;if(typeof $[Z]==="function")$[Z](X);else if(typeof $[Z]==="object")o0($[Z],X,J)}},f0=($)=>$.trim().length!==0&&!Number.isNaN(Number($));var S1=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,D0=Symbol("ElysiaErrorCode"),c=Symbol("ElysiaResponse"),N0=(S1?.NODE_ENV??S1?.ENV)==="production",N$=($,W)=>({[c]:O0[$]??$,response:W});class k0 extends Error{code="INTERNAL_SERVER_ERROR";status=500;constructor($){super($??"INTERNAL_SERVER_ERROR")}}class o extends Error{code="NOT_FOUND";status=404;constructor($){super($??"NOT_FOUND")}}class q1 extends Error{code="PARSE";status=400;constructor($){super($??"PARSE")}}class U0 extends Error{$;code="INVALID_COOKIE_SIGNATURE";status=400;constructor($,W){super(W??`"${$}" has invalid cookie signature`);this.key=$}}class R extends Error{$;W;J;code="VALIDATION";status=400;constructor($,W,J){const Z=N0?void 0:("Errors"in W)?W.Errors(J).First():e0.Errors(W,J).First(),X=Z?.schema.error?typeof Z.schema.error==="function"?Z.schema.error($,W,J):Z.schema.error:void 0,B=Z?.path?.slice(1)||"root";let Y="";if(X)Y=typeof X==="object"?JSON.stringify(X):X+"";else if(N0)Y=JSON.stringify({type:$,message:Z?.message});else Y=JSON.stringify({type:$,at:B,message:Z?.message,expected:e0.Create(W.schema),found:J,errors:[...W.Errors(J)]},null,2);super(Y);this.type=$;this.validator=W;this.value=J;Object.setPrototypeOf(this,R.prototype)}get all(){return[...this.validator.Errors(this.value)]}static simplifyModel($){const W="schema"in $?$.schema:$;try{return e0.Create(W)}catch{return W}}get model(){return R.simplifyModel(this.validator)}toResponse($){return new Response(this.message,{status:400,headers:$})}}var $1={open($){$.data.open?.($)},message($,W){$.data.message?.($,W)},drain($){$.data.drain?.($)},close($,W,J){$.data.close?.($,W,J)}};class _0{$;W;validator;constructor($,W){this.raw=$;this.data=W;if(this.validator=$.data.validator,$.data.id)this.id=$.data.id;else{const J=new Uint32Array(1);crypto.getRandomValues(J),this.id=J[0].toString()}}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,W=void 0,J)=>{if(this.validator?.Check(W)===!1)throw new R("message",this.validator,W);if(typeof W==="object")W=JSON.stringify(W);return this.raw.publish($,W,J),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new R("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}}var c1=R0(X1(),1),d1=R0(J1(),1);import{Value as j0} from"@sinclair/typebox/value";var w$=(new Headers()).toJSON,p1=new RegExp(" (\\w+) = context","g"),l1={value:0},i1=({hasTrace:$,hasTraceSet:W=!1,addFn:J,condition:Z={}})=>{if($)return J("\nconst reporter = getReporter()\n"),(X,{name:B,attribute:Y="",unit:D=0}={})=>{const Q=X.indexOf("."),z=Q===-1;if(X!=="request"&&X!=="response"&&!Z[z?X:X.slice(0,Q)])return()=>{if(W&&X==="afterHandle")J("\nawait traceDone\n")};if(z)B||=X;else B||="anonymous";J("\n"+`reporter.emit('event', {
					id,
					event: '${X}',
					type: 'begin',
					name: '${B}',
					time: performance.now(),
					${z?`unit: ${D},`:""}
					${Y}
				})`.replace(/(\t| |\n)/g,"")+"\n");let G=!1;return()=>{if(G)return;if(G=!0,J("\n"+`reporter.emit('event', {
							id,
							event: '${X}',
							type: 'end',
							time: performance.now()
						})`.replace(/(\t| |\n)/g,"")+"\n"),W&&X==="afterHandle")J("\nawait traceDone\n")}};else return()=>()=>{}},P0=($)=>{const W=$.indexOf(")");if($.charCodeAt(W+2)===61&&$.charCodeAt(W+5)!==123)return!0;return $.includes("return")},C$=($,{injectResponse:W=""}={})=>({composeValidation:(J,Z=`c.${J}`)=>$?`c.set.status = 400; throw new ValidationError(
'${J}',
${J},
${Z}
)`:`c.set.status = 400; return new ValidationError(
	'${J}',
	${J},
	${Z}
).toResponse(c.set.headers)`,composeResponseValidation:(J="r")=>{const Z=$?`throw new ValidationError(
'response',
response[c.set.status],
${J}
)`:`return new ValidationError(
'response',
response[c.set.status],
${J}
).toResponse(c.set.headers)`;return`\n${W}
		if(!(${J} instanceof Response) && response[c.set.status]?.Check(${J}) === false) {
	if(!(response instanceof Error))
		${Z}
}\n`}}),b=($,W)=>{if(W.startsWith("[object "))return!1;if(W=W.trimStart(),W=W.replaceAll(/^async /g,""),/^(\w+)\(/g.test(W))W=W.slice(W.indexOf("("));const J=W.charCodeAt(0)===40||W.startsWith("function")?W.slice(W.indexOf("(")+1,W.indexOf(")")):W.slice(0,W.indexOf("=")-1);if(J==="")return!1;const Z=J.charCodeAt(0)===123?J.indexOf("..."):-1;if(J.charCodeAt(0)===123){if(J.includes($))return!0;if(Z===-1)return!1}if(W.match(new RegExp(`${J}(.${$}|\\["${$}"\\])`)))return!0;const X=Z!==-1?J.slice(Z+3,J.indexOf(" ",Z+3)):void 0;if(W.match(new RegExp(`${X}(.${$}|\\["${$}"\\])`)))return!0;const B=[J];if(X)B.push(X);for(let D of W.matchAll(p1))B.push(D[1]);const Y=new RegExp(`{.*?} = (${B.join("|")})`,"g");for(let[D]of W.matchAll(Y))if(D.includes(`{ ${$}`)||D.includes(`, ${$}`))return!0;return!1},T0=($)=>{if($=$.trimStart(),$.startsWith("[object"))return!1;if($=$.replaceAll(/^async /g,""),/^(\w+)\(/g.test($))$=$.slice($.indexOf("("));const W=$.charCodeAt(0)===40||$.startsWith("function")?$.slice($.indexOf("(")+1,$.indexOf(")")):$.slice(0,$.indexOf("=")-1);if(W==="")return!1;const J=W.charCodeAt(0)===123?W.indexOf("..."):-1,Z=J!==-1?W.slice(J+3,W.indexOf(" ",J+3)):void 0,X=[W];if(Z)X.push(Z);for(let Y of $.matchAll(p1))X.push(Y[1]);for(let Y of X)if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;const B=new RegExp(`{.*?} = (${X.join("|")})`,"g");for(let[Y]of $.matchAll(B))if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;return!1},G0=Symbol.for("TypeBox.Kind"),m0=($,W)=>{if(!W)return;if(G0 in W&&W[G0]===$)return!0;if(W.type==="object"){const J=W.properties;for(let Z of Object.keys(J)){const X=J[Z];if(X.type==="object"){if(m0($,X))return!0}else if(X.anyOf){for(let B=0;B<X.anyOf.length;B++)if(m0($,X.anyOf[B]))return!0}if(G0 in X&&X[G0]===$)return!0}return!1}return W.properties&&G0 in W.properties&&W.properties[G0]===$},e=($,W)=>{if(!W)return;if(W.type==="object"){const J=W.properties;if(!J)return!1;for(let Z of Object.keys(J)){const X=J[Z];if($ in X)return!0;if(X.type==="object"){if(e($,X))return!0}else if(X.anyOf){for(let B=0;B<X.anyOf.length;B++)if(e($,X.anyOf[B]))return!0}}return!1}return $ in W},B1=Symbol.for("TypeBox.Transform"),$0=($)=>{if(!$)return;if($.type==="object"&&$.properties){const W=$.properties;for(let J of Object.keys(W)){const Z=W[J];if(Z.type==="object"){if($0(Z))return!0}else if(Z.anyOf){for(let B=0;B<Z.anyOf.length;B++)if($0(Z.anyOf[B]))return!0}if(B1 in Z)return!0}return!1}return B1 in $||$.properties&&B1 in $.properties},R$=($)=>{if(!$)return;const W=$?.schema;if(W&&"anyOf"in W){let J=!1;const Z=W.anyOf[0].type;for(let X of W.anyOf)if(X.type!==Z){J=!0;break}if(!J)return Z}return $.schema?.type},E$=/(?:return|=>) \S+\(/g,L=($)=>{if($.constructor.name==="AsyncFunction")return!0;const W=$.toString();if(W.includes("=> response.clone("))return!1;return!!W.match(E$)},H$=($)=>{if(!$.includes("query: {")||$.includes("query,")||$.includes("query }"))return!1;const W=$.indexOf("query: {");return $=$.slice(W+9),$=$.slice(0,$.indexOf("}")),$.split(",").map((J)=>{const Z=J.indexOf(":");if(Z===-1)return J.trim();return J.slice(0,Z).trim()})},n1=({path:$,method:W,hooks:J,validator:Z,handler:X,handleError:B,definitions:Y,schema:D,onRequest:Q,config:z,getReporter:G,setHeader:U})=>{const T=z.forceErrorEncapsulation||J.error.length>0||typeof Bun==="undefined"||J.onResponse.length>0||!!J.trace.length,j=typeof X==="function",K=j?"handler(c)":"handler",P=J.onResponse.length?`\n;(async () => {${J.onResponse.map((M,O)=>`await res${O}(c)`).join(";")}})();\n`:"",I=J.trace.map((M)=>M.toString());let A=!1;if(j&&T0(X.toString()))A=!0;if(!A)for(let[M,O]of Object.entries(J)){if(!Array.isArray(O)||!O.length||!["parse","transform","beforeHandle","afterHandle","onResponse"].includes(M))continue;for(let F of O){if(typeof F!=="function")continue;if(T0(F.toString())){A=!0;break}}if(A)break}const N={parse:I.some((M)=>b("parse",M)),transform:I.some((M)=>b("transform",M)),handle:I.some((M)=>b("handle",M)),beforeHandle:I.some((M)=>b("beforeHandle",M)),afterHandle:I.some((M)=>b("afterHandle",M)),error:T||I.some((M)=>b("error",M))},V=J.trace.length>0;let _="";const k=Z||W!=="GET"&&W!=="HEAD"?[X,...J.transform,...J.beforeHandle,...J.afterHandle,...J.mapResponse].map((M)=>typeof M==="function"?M.toString():`${M}`):[],V0=W!=="GET"&&W!=="HEAD"&&(A||J.type!=="none"&&(!!Z.body||!!J.type||k.some((M)=>b("body",M)))),h0=A||Z.headers||k.some((M)=>b("headers",M))||U&&Object.keys(U).length,S0=A||!!Z.cookie||k.some((M)=>b("cookie",M)),x=Z?.cookie?.schema;let r="";if(x?.sign){if(!x.secrets)throw new Error(`t.Cookie required secret which is not set in (${W}) ${$}.`);const M=!x.secrets?void 0:typeof x.secrets==="string"?x.secrets:x.secrets[0];if(r+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,x.sign===!0)r+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${M}')
			}`;else for(let O of x.sign)r+=`if(_setCookie['${O}']?.value) { c.set.cookie['${O}'].value = await signCookie(_setCookie['${O}'].value, '${M}') }\n`;r+="}\n"}const{composeValidation:J0,composeResponseValidation:q0}=C$(T);if(h0)_+=w$?"c.headers = c.request.headers.toJSON()\n":`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(S0){const M=(F,S)=>{const w=x?.[F]??S;if(!w)return typeof S==="string"?`${F}: "${S}",`:`${F}: ${S},`;if(typeof w==="string")return`${F}: '${w}',`;if(w instanceof Date)return`${F}: new Date(${w.getTime()}),`;return`${F}: ${w},`},O=x?`{
			secret: ${x.secrets!==void 0?typeof x.secrets==="string"?`'${x.secrets}'`:"["+x.secrets.reduce((F,S)=>F+`'${S}',`,"")+"]":"undefined"},
			sign: ${x.sign===!0?!0:x.sign!==void 0?"["+x.sign.reduce((F,S)=>F+`'${S}',`,"")+"]":"undefined"},
			${M("domain")}
			${M("expires")}
			${M("httpOnly")}
			${M("maxAge")}
			${M("path","/")}
			${M("priority")}
			${M("sameSite")}
			${M("secure")}
		}`:"undefined";if(h0)_+=`\nc.cookie = await parseCookie(c.set, c.headers.cookie, ${O})\n`;else _+=`\nc.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${O})\n`}if(A||Z.query||k.some((M)=>b("query",M))){let M=[],O=!1;if(Z.query&&Z.query.schema.type==="object")M=Object.keys(Z.query.schema.properties);else for(let F of k){const S=H$(F);if(!S){O=!0;continue}for(let w of S)if(M.indexOf(w)===-1)M.push(w)}if(!O&&M.length)_+=`
			let requestUrl = c.request.url.slice(c.qi + 1)
			if(requestUrl.includes('+')) requestUrl = requestUrl.replaceAll('+', ' ')

			if(c.qi !== -1) {	
				const url = decodeURIComponent(requestUrl)
				let memory = 0

				${M.map((F,S)=>`
						memory = url.indexOf('${F}=')

						const a${S} = memory === -1 ? undefined : url.slice(memory = memory + ${F.length+1}, (memory = url.indexOf('&', memory)) === -1 ? undefined : memory)`).join("\n")}

				c.query = {
					${M.map((F,S)=>`${F}: a${S}`).join(", ")}
				}
			} else {
				c.query = {}
			}`;else _+="c.query = c.qi !== -1 ? parseQuery(decodeURIComponent(c.request.url.slice(c.qi + 1))) : {}"}const w0=J.trace.map((M)=>M.toString()).some((M)=>b("set",M)||T0(M));A||J.trace.some((M)=>b("set",M.toString()));const C0=U&&Object.keys(U).length||w0||S0||k.some((M)=>b("set",M))||Q.some((M)=>b("set",M.toString()));if(V)_+="\nconst id = c.$$requestId\n";const E=i1({hasTrace:V,hasTraceSet:w0,condition:N,addFn:(M)=>{_+=M}});if(_+=T?"\n try {\n":"",w0){_+="\nconst traceDone = Promise.all([";for(let M=0;M<J.trace.length;M++)_+=`new Promise(r => { reporter.once(\`res\${id}.${M}\`, r) }),`;_+="])\n"}const Z0=typeof X==="function"&&L(X),c0=S0||V0||w0||Z0||!!J.mapResponse.length||J.parse.length>0||J.afterHandle.some(L)||J.beforeHandle.some(L)||J.transform.some(L),o1=E("parse",{unit:J.parse.length});if(V0){const M=R$(Z?.body);if(J.type&&!Array.isArray(J.type)){if(J.type)switch(J.type){case"json":case"application/json":_+="c.body = await c.request.json()\n";break;case"text":case"text/plain":_+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":_+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":_+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":_+=`c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}\n`;break}if(J.parse.length)_+="}}"}else{const F=(()=>{if(J.parse.length&&M&&!Array.isArray(J.type)){const S=Z?.body?.schema;switch(M){case"object":if(m0("File",S)||m0("Files",S))return`c.body = {}

								const form = await c.request.formData()
								for (const key of form.keys()) {
									if (c.body[key])
										continue

									const value = form.getAll(key)
									if (value.length === 1)
										c.body[key] = value[0]
									else c.body[key] = value
								}`;break;default:break}}})();if(F)_+=F;else{if(_+="\n",_+=h0?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",_+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)\n`,J.parse.length){_+="let used = false\n";const S=E("parse",{unit:J.parse.length});for(let w=0;w<J.parse.length;w++){const d0=E("parse.unit",{name:J.parse[w].name}),C=`bo${w}`;if(w!==0)_+="if(!used) {\n";if(_+=`let ${C} = parse[${w}](c, contentType)\n`,_+=`if(${C} instanceof Promise) ${C} = await ${C}\n`,_+=`if(${C} !== undefined) { c.body = ${C}; used = true }\n`,d0(),w!==0)_+="}"}S()}if(J.parse.length)_+="if (!used)";_+=`
				switch (contentType) {
					case 'application/json':
						c.body = await c.request.json()
						break

					case 'text/plain':
						c.body = await c.request.text()
						break

					case 'application/x-www-form-urlencoded':
						c.body = parseQuery(await c.request.text())
						break

					case 'application/octet-stream':
						c.body = await c.request.arrayBuffer();
						break

					case 'multipart/form-data':
						c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}

						break
					}\n`,_+="}\n"}}_+="\n"}if(o1(),J?.transform){const M=E("transform",{unit:J.transform.length});for(let O=0;O<J.transform.length;O++){const F=J.transform[O],S=E("transform.unit",{name:F.name});if(F.$elysia==="derive")_+=L(F)?`Object.assign(c, await transform[${O}](c));`:`Object.assign(c, transform[${O}](c));`;else _+=L(F)?`await transform[${O}](c);`:`transform[${O}](c);`;S()}M()}if(Z){if(_+="\n",Z.headers){if(e("default",Z.headers.params))for(let[M,O]of Object.entries(j0.Default(Z.headers.schema,{}))){const F=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(F)_+=`c.headers['${M}'] ??= ${F}\n`}if(_+=`if(headers.Check(c.headers) === false) {
				${J0("headers")}
			}`,$0(Z.headers.schema))_+="\nc.headers = headers.Decode(c.headers)\n"}if(Z.params){if(e("default",Z.params.schema))for(let[M,O]of Object.entries(j0.Default(Z.params.schema,{}))){const F=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(F)_+=`c.params['${M}'] ??= ${F}\n`}if(_+=`if(params.Check(c.params) === false) {
				${J0("params")}
			}`,$0(Z.params.schema))_+="\nc.params = params.Decode(c.params)\n"}if(Z.query){if(e("default",Z.query.schema))for(let[M,O]of Object.entries(j0.Default(Z.query.schema,{}))){const F=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(F)_+=`c.query['${M}'] ??= ${F}\n`}if(_+=`if(query.Check(c.query) === false) {
				${J0("query")}
			}`,$0(Z.query.schema))_+="\nc.query = query.Decode(Object.assign({}, c.query))\n"}if(Z.body){if(e("default",Z.body.schema))_+=`if(body.Check(c.body) === false) {
    				c.body = Object.assign(${JSON.stringify(j0.Default(Z.body.schema,null)??{})}, c.body)

    				if(body.Check(c.query) === false) {
        				${J0("body")}
     			}
            }`;else _+=`if(body.Check(c.body) === false) {
			${J0("body")}
		}`;if($0(Z.body.schema))_+="\nc.body = body.Decode(c.body)\n"}if(u(Z.cookie?.schema.properties??{})){if(_+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value\n`,e("default",Z.cookie.schema))for(let[M,O]of Object.entries(j0.Default(Z.cookie.schema,{})))_+=`cookieValue['${M}'] = ${typeof O==="object"?JSON.stringify(O):O}\n`;if(_+=`if(cookie.Check(cookieValue) === false) {
				${J0("cookie","cookieValue")}
			}`,$0(Z.cookie.schema))_+="\nc.cookie = params.Decode(c.cookie)\n"}}if(J?.beforeHandle){const M=E("beforeHandle",{unit:J.beforeHandle.length});for(let O=0;O<J.beforeHandle.length;O++){const F=J.beforeHandle[O],S=E("beforeHandle.unit",{name:F.name}),w=P0(F.toString());if(F.$elysia==="resolve")_+=L(F)?`Object.assign(c, await beforeHandle[${O}](c));`:`Object.assign(c, beforeHandle[${O}](c));`;else if(!w)_+=L(F)?`await beforeHandle[${O}](c);\n`:`beforeHandle[${O}](c);\n`,S();else{_+=L(F)?`be = await beforeHandle[${O}](c);\n`:`be = beforeHandle[${O}](c);\n`,S(),_+="if(be !== undefined) {\n";const d0=E("afterHandle",{unit:J.transform.length});if(J.afterHandle){E("handle",{name:j?X.name:void 0})();for(let C=0;C<J.afterHandle.length;C++){const e1=P0(J.afterHandle[C].toString()),$$=E("afterHandle.unit",{name:J.afterHandle[C].name});if(_+="c.response = be\n",!e1)_+=L(J.afterHandle[C])?`await afterHandle[${C}](c, be)\n`:`afterHandle[${C}](c, be)\n`;else _+=L(J.afterHandle[C])?`af = await afterHandle[${C}](c)\n`:`af = afterHandle[${C}](c)\n`,_+="if(af !== undefined) { c.response = be = af }\n";$$()}}if(d0(),Z.response)_+=q0("be");if(J.mapResponse.length){_+="c.response = be";for(let C=0;C<J.mapResponse.length;C++)_+=`\nif(mr === undefined) {
							mr = onMapResponse[${C}](c)
							if(mr instanceof Promise) mr = await mr
							if(mr !== undefined) c.response = mr
						}\n`}_+=r,_+="return mapEarlyResponse(be, c.set)}\n"}}M()}if(J?.afterHandle.length){const M=E("handle",{name:j?X.name:void 0});if(J.afterHandle.length)_+=Z0?`let r = c.response = await ${K};\n`:`let r = c.response = ${K};\n`;else _+=Z0?`let r = await ${K};\n`:`let r = ${K};\n`;M();const O=E("afterHandle",{unit:J.afterHandle.length});for(let F=0;F<J.afterHandle.length;F++){const S=P0(J.afterHandle[F].toString()),w=E("afterHandle.unit",{name:J.afterHandle[F].name});if(!S)_+=L(J.afterHandle[F])?`await afterHandle[${F}](c)\n`:`afterHandle[${F}](c)\n`,w();else if(_+=L(J.afterHandle[F])?`af = await afterHandle[${F}](c)\n`:`af = afterHandle[${F}](c)\n`,w(),Z.response)_+="if(af !== undefined) {",O(),_+=q0("af"),_+="c.response = af }";else _+="if(af !== undefined) {",O(),_+="c.response = af}\n"}if(O(),_+="r = c.response\n",Z.response)_+=q0();if(_+=r,J.mapResponse.length)for(let F=0;F<J.mapResponse.length;F++)_+=`\nmr = onMapResponse[${F}](c)
				if(mr instanceof Promise) mr = await mr
				if(mr !== undefined) c.response = mr\n`;if(C0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else{const M=E("handle",{name:j?X.name:void 0});if(Z.response||J.mapResponse.length){if(_+=Z0?`let r = await ${K};\n`:`let r = ${K};\n`,M(),Z.response)_+=q0();if(E("afterHandle")(),J.mapResponse.length){_+="c.response = r";for(let O=0;O<J.mapResponse.length;O++)_+=`\nif(mr === undefined) { 
						mr = onMapResponse[${O}](c)
						if(mr instanceof Promise) mr = await mr
    					if(mr !== undefined) r = c.response = mr
					}\n`}if(_+=r,X instanceof Response)_+=`return ${K}.clone()\n`;else if(C0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else if(N.handle||S0){if(_+=Z0?`let r = await ${K};\n`:`let r = ${K};\n`,M(),E("afterHandle")(),J.mapResponse.length){_+="c.response = r";for(let O=0;O<J.mapResponse.length;O++)_+=`\nif(mr === undefined) {
							mr = onMapResponse[${O}](c)
							if(mr instanceof Promise) mr = await mr
    						if(mr !== undefined) r = c.response = mr
						}\n`}if(_+=r,C0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else{M();const O=Z0?`await ${K}`:K;if(E("afterHandle")(),X instanceof Response)_+=`return ${K}.clone()\n`;else if(C0)_+=`return mapResponse(${O}, c.set)\n`;else _+=`return mapCompactResponse(${O})\n`}}if(T||P){if(_+=`
} catch(error) {`,!c0)_+="return (async () => {";_+=`const set = c.set

		if (!set.status || set.status < 300) set.status = error?.status || 500
	`;const M=E("error",{unit:J.error.length});if(J.error.length){_+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
			`;for(let O=0;O<J.error.length;O++){const F=`er${O}`,S=E("error.unit",{name:J.error[O].name});if(_+=`\nlet ${F} = handleErrors[${O}](c)\n`,L(J.error[O]))_+=`if (${F} instanceof Promise) ${F} = await ${F}\n`;S(),_+=`${F} = mapEarlyResponse(${F}, set)\n`,_+=`if (${F}) {`,_+=`return ${F} }\n`}}if(M(),_+="return handleError(c, error)\n\n",!c0)_+="})()";if(_+="}",P||V){_+=" finally { ";const O=E("response",{unit:J.onResponse.length});_+=P,O(),_+="}"}}return _=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			onResponse
		},
		validator: {
			body,
			headers,
			params,
			query,
			response,
			cookie
		},
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError
		},
		schema,
		definitions,
		ERROR_CODE,
		getReporter,
		requestId,
		parseCookie,
		signCookie,
		decodeURIComponent
	} = hooks

	${J.onResponse.length?`const ${J.onResponse.map((M,O)=>`res${O} = onResponse[${O}]`).join(",")}`:""}

	return ${c0?"async":""} function handle(c) {
		${J.beforeHandle.length?"let be":""}
		${J.afterHandle.length?"let af":""}
		${J.mapResponse.length?"let mr":""}

		${D&&Y?"c.schema = schema; c.defs = definitions;":""}
		${_}
	}`,Function("hooks",_)({handler:X,hooks:J,validator:Z,handleError:B,utils:{mapResponse:v,mapCompactResponse:i,mapEarlyResponse:y,parseQuery:c1.parse},error:{NotFoundError:o,ValidationError:R,InternalServerError:k0},schema:D,definitions:Y,ERROR_CODE:D0,getReporter:G,requestId:l1,parseCookie:g0,signCookie:Q0,decodeURIComponent:d1.default})},Y1=($)=>{let W="",J="";for(let K of Object.keys($.decorators))W+=`,${K}: app.decorators.${K}`;const{router:Z,staticRouter:X}=$,B=$.event.trace.length>0,Y=`
	const route = router.find(request.method, path) ${Z.root.ALL?'?? router.find("ALL", path)':""}
	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params

	return route.store(ctx)`;let D="";for(let[K,{code:P,all:I}]of Object.entries(X.map))D+=`case '${K}':\nswitch(request.method) {\n${P}\n${I??"default: break map"}}\n\n`;const Q=$.event.request.some(L);if(J+=`const {
		app,
		app: { store, router, staticRouter, wsRouter },
		mapEarlyResponse,
		NotFoundError,
		requestId,
		getReporter,
		handleError
	} = data

	const notFound = new NotFoundError()

	${$.event.request.length?"const onRequest = app.event.request":""}
	${X.variables}
	${$.event.error.length?"":`
	const error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });
	`}

	return ${Q?"async":""} function map(request) {\n`,$.event.request.length)J+="let re";const z=$.event.trace.map((K)=>K.toString()),G=i1({hasTrace:B,hasTraceSet:$.event.trace.some((K)=>{const P=K.toString();return b("set",P)||T0(P)}),condition:{request:z.some((K)=>b("request",K)||T0(K))},addFn:(K)=>{J+=K}});if($.event.request.length){J+=`
			${B?"const id = +requestId.value++":""}

			const ctx = {
				request,
				store,
				set: {
					headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
					status: 200
				}
				${B?",$$requestId: +id":""}
				${W}
			}
		`;const K=G("request",{attribute:"ctx",unit:$.event.request.length});J+="\n try {\n";for(let P=0;P<$.event.request.length;P++){const I=$.event.request[P],A=P0(I.toString()),N=L(I),V=G("request.unit",{name:$.event.request[P].name});if(A){if(J+=`re = mapEarlyResponse(
					${N?"await":""} onRequest[${P}](ctx),
					ctx.set
				)\n`,V(),A)J+="if(re !== undefined) return re\n"}else J+=`${N?"await":""} onRequest[${P}](ctx)\n`,V()}J+=`} catch (error) {
			return app.handleError(ctx, error)
		}`,K(),J+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = ctx.qi = url.indexOf('?', s + 1)
		const path = ctx.path = url.substring(s, qi === -1 ? undefined : qi)`}else J+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = url.indexOf('?', s + 1)
		const path = url.substring(s, qi === -1 ? undefined : qi)
		${B?"const id = +requestId.value++":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			set: {
				headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			}
			${B?",$$requestId: id":""}
			${W}
		}`,G("request",{unit:$.event.request.length,attribute:z.some((K)=>b("context",K))||z.some((K)=>b("store",K))||z.some((K)=>b("set",K))?"ctx":""})();const{wsPaths:U,wsRouter:T}=$;if(Object.keys(U).length||T.history.length){J+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[K,P]of Object.entries(U))J+=`
					case '${K}':
						if(request.headers.get('upgrade') === 'websocket')
							return st${P}(ctx)

						break`;J+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							return route.store(ctx)
						}
					}

					break
			}
		}\n`}J+=`
		map: switch(path) {
			${D}

			default:
				break
		}

		${Y}
	}`;const j=Q1($);return $.handleError=j,Function("data",J)({app:$,mapEarlyResponse:y,NotFoundError:o,getReporter:()=>$.reporter,requestId:l1,handleError:j})},Q1=($)=>{let W=`const {
		app: { event: { error: onError, onResponse: res } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE
	} = inject

	return ${$.event.error.find(L)?"async":""} function(context, error) {
		let r

		const { set } = context

		context.code = error.code
		context.error = error

		if(error[ELYSIA_RESPONSE]) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}
`;for(let J=0;J<$.event.error.length;J++){const Z=$.event.error[J],X=`${L(Z)?"await ":""}onError[${J}](context)`;if(P0(Z.toString()))W+=`r = ${X}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}
		
				if(set.status === 200) set.status = error.status
				return mapResponse(r, set)
			}\n`;else W+=X+"\n"}return W+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 400
		return new Response(
			error.message,
			{ headers: set.headers, status: set.status }
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)

		return mapResponse(error, set)
	}
}`,Function("inject",W)({app:$,mapResponse:v,ERROR_CODE:D0,ELYSIA_RESPONSE:c})};var u0=R0(X1(),1);var D1=($)=>async(W)=>{const J={cookie:{},status:200,headers:{}};let Z;if($.decorators)Z=$.decorators,Z.request=W,Z.set=J,Z.store=$.store;else Z={set:J,store:$.store,request:W};const X=W.url,B=X.indexOf("/",11),Y=X.indexOf("?",B+1),D=Y===-1?X.substring(B):X.substring(B,Y);try{for(let I=0;I<$.event.request.length;I++){const A=$.event.request[I];let N=A(Z);if(N instanceof Promise)N=await N;if(N=y(N,J),N)return N}const Q=$.dynamicRouter.find(W.method,D)??$.dynamicRouter.find("ALL",D);if(!Q)throw new o;const{handle:z,hooks:G,validator:U,content:T}=Q.store;let j;if(W.method!=="GET"&&W.method!=="HEAD")if(T)switch(T){case"application/json":j=await W.json();break;case"text/plain":j=await W.text();break;case"application/x-www-form-urlencoded":j=u0.parse(await W.text());break;case"application/octet-stream":j=await W.arrayBuffer();break;case"multipart/form-data":j={};const I=await W.formData();for(let A of I.keys()){if(j[A])continue;const N=I.getAll(A);if(N.length===1)j[A]=N[0];else j[A]=N}break}else{let I=W.headers.get("content-type");if(I){const A=I.indexOf(";");if(A!==-1)I=I.slice(0,A);for(let N=0;N<G.parse.length;N++){let V=G.parse[N](Z,I);if(V instanceof Promise)V=await V;if(V){j=V;break}}if(j===void 0)switch(I){case"application/json":j=await W.json();break;case"text/plain":j=await W.text();break;case"application/x-www-form-urlencoded":j=u0.parse(await W.text());break;case"application/octet-stream":j=await W.arrayBuffer();break;case"multipart/form-data":j={};const N=await W.formData();for(let V of N.keys()){if(j[V])continue;const _=N.getAll(V);if(_.length===1)j[V]=_[0];else j[V]=_}break}}}Z.body=j,Z.params=Q?.params||void 0,Z.query=Y===-1?{}:u0.parse(X.substring(Y+1)),Z.headers={};for(let[I,A]of W.headers.entries())Z.headers[I]=A;const K=U?.cookie?.schema;Z.cookie=await g0(Z.set,Z.headers.cookie,K?{secret:K.secrets!==void 0?typeof K.secrets==="string"?K.secrets:K.secrets.join(","):void 0,sign:K.sign===!0?!0:K.sign!==void 0?typeof K.sign==="string"?K.sign:K.sign.join(","):void 0}:void 0);for(let I=0;I<G.transform.length;I++){const A=G.transform[I](Z);if(G.transform[I].$elysia==="derive")if(A instanceof Promise)Object.assign(Z,await A);else Object.assign(Z,A);else if(A instanceof Promise)await A}if(U){if(U.headers){const I={};for(let A in W.headers)I[A]=W.headers.get(A);if(U.headers.Check(I)===!1)throw new R("header",U.headers,I)}if(U.params?.Check(Z.params)===!1)throw new R("params",U.params,Z.params);if(U.query?.Check(Z.query)===!1)throw new R("query",U.query,Z.query);if(U.cookie){const I={};for(let[A,N]of Object.entries(Z.cookie))I[A]=N.value;if(U.cookie?.Check(I)===!1)throw new R("cookie",U.cookie,I)}if(U.body?.Check(j)===!1)throw new R("body",U.body,j)}for(let I=0;I<G.beforeHandle.length;I++){let A=G.beforeHandle[I](Z);if(A instanceof Promise)A=await A;if(A!==void 0){Z.response=A;for(let V=0;V<G.afterHandle.length;V++){let _=G.afterHandle[V](Z);if(_ instanceof Promise)_=await _;if(_)A=_}const N=y(A,Z.set);if(N)return N}}let P=z(Z);if(P instanceof Promise)P=await P;if(!G.afterHandle.length){const I=U?.response?.[P.status];if(I?.Check(P)===!1)throw new R("response",I,P)}else{Z.response=P;for(let I=0;I<G.afterHandle.length;I++){let A=G.afterHandle[I](Z);if(A instanceof Promise)A=await A;const N=y(A,Z.set);if(N!==void 0){const V=U?.response?.[P.status];if(V?.Check(N)===!1)throw new R("response",V,N);return N}}}if(Z.set.cookie&&K?.sign){const I=!K.secrets?void 0:typeof K.secrets==="string"?K.secrets:K.secrets[0];if(K.sign===!0)for(let[A,N]of Object.entries(Z.set.cookie))Z.set.cookie[A].value=await Q0(N.value,"${secret}");else for(let A of K.sign){if(!(A in K.properties))continue;if(Z.set.cookie[A]?.value)Z.set.cookie[A].value=await Q0(Z.set.cookie[A].value,I)}}return v(P,Z.set)}catch(Q){if(Q.status)J.status=Q.status;return $.handleError(Z,Q)}finally{for(let Q of $.event.onResponse)await Q(Z)}},r1=($)=>async(W,J)=>{const Z=Object.assign(W,{error:J,code:J.code});Z.set=W.set;for(let X=0;X<$.event.error.length;X++){let B=$.event.error[X](Z);if(B instanceof Promise)B=await B;if(B!==void 0&&B!==null)return v(B,W.set)}return new Response(typeof J.cause==="string"?J.cause:J.message,{headers:W.set.headers,status:J.status??500})};import{TypeSystem as z0} from"@sinclair/typebox/system";import{Type as a1,FormatRegistry as s1} from"@sinclair/typebox";import{Value as b$} from"@sinclair/typebox/value";import{TypeSystemPolicy as vW,TypeSystem as kW,TypeSystemDuplicateFormat as mW,TypeSystemDuplicateTypeKind as uW} from"@sinclair/typebox/system";import{TypeCompiler as cW,TypeCheck as dW} from"@sinclair/typebox/compiler";var q=Object.assign({},a1);try{z0.Format("email",($)=>/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test($)),z0.Format("uuid",($)=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test($)),z0.Format("date",($)=>!Number.isNaN(new Date($).getTime())),z0.Format("date-time",($)=>!Number.isNaN(new Date($).getTime()))}catch{}var t1=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},_1=($,W)=>{if(!(W instanceof Blob))return!1;if($.minSize&&W.size<t1($.minSize))return!1;if($.maxSize&&W.size>t1($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!W.type.startsWith($.extension))return!1}else{for(let J=0;J<$.extension.length;J++)if(W.type.startsWith($.extension[J]))return!0;return!1}return!0},L$=z0.Type("Files",($,W)=>{if(!Array.isArray(W))return _1($,W);if($.minItems&&W.length<$.minItems)return!1;if($.maxItems&&W.length>$.maxItems)return!1;for(let J=0;J<W.length;J++)if(!_1($,W[J]))return!1;return!0});s1.Set("numeric",($)=>!!$&&!isNaN(+$));s1.Set("ObjectString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var W0={Numeric:($)=>{const W=a1.Number($);return q.Transform(q.Union([q.String({format:"numeric",default:0}),q.Number($)],$)).Decode((J)=>{const Z=+J;if(isNaN(Z))return J;if($&&!b$.Check(W,Z))throw new R("property",W,Z);return Z}).Encode((J)=>J)},ObjectString:($,W)=>q.Transform(q.Union([q.String({format:"ObjectString",default:""}),q.Object($,W)],W)).Decode((J)=>{if(typeof J==="string")try{return JSON.parse(J)}catch{return J}return J}).Encode((J)=>JSON.stringify(J)),File:z0.Type("File",_1),Files:($={})=>q.Transform(q.Union([L$($)])).Decode((W)=>{if(Array.isArray(W))return W;return[W]}).Encode((W)=>W),Nullable:($)=>q.Union([q.Null(),$]),MaybeEmpty:($)=>q.Union([q.Null(),q.Undefined(),$]),Cookie:($,W)=>q.Object($,W)};q.ObjectString=W0.ObjectString;q.Numeric=W0.Numeric;q.File=($={})=>W0.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});q.Files=($={})=>W0.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});q.Nullable=($)=>W0.Nullable($);q.MaybeEmpty=W0.MaybeEmpty;q.Cookie=W0.Cookie;class n{config;dependencies={};store={};decorators={};definitions={type:{},error:{}};schema={};macros=[];event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],onResponse:[],trace:[],error:[],stop:[]};reporter=new O1;server=null;getServer(){return this.server}validator=null;router=new s;wsRouter=new s;routes=[];staticRouter={handlers:[],variables:"",map:{},all:""};wsPaths={};dynamicRouter=new s;lazyLoadModules=[];path="";stack=void 0;constructor($){if(this.config={forceErrorEncapsulation:!0,prefix:"",aot:!0,strictPath:!1,scoped:!1,cookie:{},analytic:!1,...$,seed:$?.seed===void 0?"":$?.seed},$?.analytic&&($?.name||$?.seed!==void 0))this.stack=new Error().stack}add($,W,J,Z,{allowMeta:X=!1,skipPrefix:B=!1}={allowMeta:!1,skipPrefix:!1}){if(typeof W==="string")W=[W];for(let Y of W){if(Y=Y===""?Y:Y.charCodeAt(0)===47?Y:`/${Y}`,this.config.prefix&&!B)Y=this.config.prefix+Y;if(Z?.type)switch(Z.type){case"text":Z.type="text/plain";break;case"json":Z.type="application/json";break;case"formdata":Z.type="multipart/form-data";break;case"urlencoded":Z.type="application/x-www-form-urlencoded";break;case"arrayBuffer":Z.type="application/octet-stream";break;default:break}const D=this.definitions.type;let Q=p(Z?.cookie??this.validator?.cookie,{dynamic:!this.config.aot,models:D,additionalProperties:!0});if(u(this.config.cookie??{}))if(Q)Q.schema=T1(Q.schema,this.config.cookie??{});else Q=p(q.Cookie({},this.config.cookie),{dynamic:!this.config.aot,models:D,additionalProperties:!0});const z={body:p(Z?.body??this.validator?.body,{dynamic:!this.config.aot,models:D}),headers:p(Z?.headers??this.validator?.headers,{dynamic:!this.config.aot,models:D,additionalProperties:!0}),params:p(Z?.params??this.validator?.params,{dynamic:!this.config.aot,models:D}),query:p(Z?.query??this.validator?.query,{dynamic:!this.config.aot,models:D}),cookie:Q,response:a0(Z?.response??this.validator?.response,{dynamic:!this.config.aot,models:D})},G=this.event,U=Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(this.macros.length){const I=(N)=>(V,_)=>{if(typeof V==="function"||Array.isArray(V)){if(!Z[N])Z[N]=[];if(typeof Z[N]==="function")Z[N]=[Z[N]];if(Array.isArray(V))Z[N]=Z[N].concat(V);else Z[N].push(V);return}const{insert:k="after",stack:V0="local"}=V;if(V0==="global"){if(!Array.isArray(_))if(k==="before")G[N].unshift(_);else G[N].push(_);else if(k==="before")G[N]=_.concat(G[N]);else G[N]=G[N].concat(_);return}else{if(!Z[N])Z[N]=[];if(typeof Z[N]==="function")Z[N]=[Z[N]];if(!Array.isArray(_))if(k==="before")Z[N].unshift(_);else Z[N].push(_);else if(k==="before")Z[N]=_.concat(Z[N]);else Z[N]=Z[N].concat(_);return}},A={events:{global:G,local:Z},onParse:I("parse"),onTransform:I("transform"),onBeforeHandle:I("beforeHandle"),onAfterHandle:I("afterHandle"),onResponse:I("onResponse"),onError:I("error")};for(let N of this.macros)o0(N(A),Z)}const T=a(G,Z),j=typeof J==="function";if(this.config.aot===!1){if(this.dynamicRouter.add($,Y,{validator:z,hooks:T,content:Z?.type,handle:J}),this.config.strictPath===!1)this.dynamicRouter.add($,U,{validator:z,hooks:T,content:Z?.type,handle:J});this.routes.push({method:$,path:Y,composed:null,handler:J,hooks:T});return}const K=n1({path:Y,method:$,hooks:T,validator:z,handler:J,handleError:this.handleError,onRequest:this.event.request,config:this.config,definitions:X?this.definitions.type:void 0,schema:X?this.schema:void 0,getReporter:()=>this.reporter,setHeader:this.setHeaders});if(!j){const I=Object.assign({headers:{},query:{},params:{},body:void 0,request:new Request(`http://localhost${Y}`),store:this.store,path:Y,set:{headers:this.setHeaders??{},status:200}},this.decorators);let A;for(let N of Object.values(T.request))try{const V=y(N(I),I.set);if(V!==void 0){A=V;break}}catch(V){A=this.handleError(I,V);break}if(A)K.response=A;else try{K.response=K(I)}catch(N){K.response=this.handleError(I,N)}}const P=this.routes.findIndex((I)=>I.path===Y&&I.method===$);if(P!==-1)this.routes.splice(P,1);if(this.routes.push({method:$,path:Y,composed:K,handler:J,hooks:T}),$==="$INTERNALWS"){const I=this.config.strictPath?void 0:Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const A=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(K),K.response instanceof Response)this.staticRouter.variables+=`const st${A} = staticRouter.handlers[${A}].response\n`;else this.staticRouter.variables+=`const st${A} = staticRouter.handlers[${A}]\n`;if(this.wsPaths[Y]=A,I)this.wsPaths[I]=A}else if(this.wsRouter.add("ws",Y,K),I)this.wsRouter.add("ws",I,K);return}if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const I=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(K),K.response instanceof Response)this.staticRouter.variables+=`const st${I} = staticRouter.handlers[${I}].response\n`;else this.staticRouter.variables+=`const st${I} = staticRouter.handlers[${I}]\n`;if(!this.staticRouter.map[Y])this.staticRouter.map[Y]={code:""};if($==="ALL")this.staticRouter.map[Y].all=`default: return st${I}(ctx)\n`;else if(K.response instanceof Response)this.staticRouter.map[Y].code=`case '${$}': return st${I}.clone()\n${this.staticRouter.map[Y].code}`;else this.staticRouter.map[Y].code=`case '${$}': return st${I}(ctx)\n${this.staticRouter.map[Y].code}`;if(!this.config.strictPath){if(!this.staticRouter.map[U])this.staticRouter.map[U]={code:""};if($==="ALL")this.staticRouter.map[U].all=`default: return st${I}(ctx)\n`;else if(K.response instanceof Response)this.staticRouter.map[U].code=`case '${$}': return st${I}.clone()\n${this.staticRouter.map[U].code}`;else this.staticRouter.map[U].code=`case '${$}': return st${I}(ctx)\n${this.staticRouter.map[U].code}`}}else if(this.router.add($,Y,K),!this.config.strictPath)this.router.add($,Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/",K)}}setHeaders;headers($){if(!$)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=d(this.setHeaders,$),this}onStart($){return this.on("start",$),this}onRequest($){return this.on("request",$),this}onParse($){return this.on("parse",$),this}onTransform($){return this.on("transform",$),this}resolve($){return $.$elysia="resolve",this.onBeforeHandle($)}onBeforeHandle($){return this.on("beforeHandle",$),this}onAfterHandle($){return this.on("afterHandle",$),this}mapResponse($){return this.on("mapResponse",$),this}onResponse($){return this.on("response",$),this}trace($){return this.reporter.on("event",A1(()=>this.reporter,this.event.trace.length,$)),this.on("trace",$),this}error($,W){switch(typeof $){case"string":return W.prototype[D0]=$,this.definitions.error[$]=W,this;case"function":return this.definitions.error=$(this.definitions.error),this}for(let[J,Z]of Object.entries($))Z.prototype[D0]=J,this.definitions.error[J]=Z;return this}onError($){return this.on("error",$),this}onStop($){return this.on("stop",$),this}on($,W){for(let J of Array.isArray(W)?W:[W])switch(J=V1(J),$){case"start":this.event.start.push(J);break;case"request":this.event.request.push(J);break;case"parse":this.event.parse.splice(this.event.parse.length-1,0,J);break;case"transform":this.event.transform.push(J);break;case"beforeHandle":this.event.beforeHandle.push(J);break;case"afterHandle":this.event.afterHandle.push(J);break;case"mapResponse":this.event.mapResponse.push(J);break;case"response":this.event.onResponse.push(J);break;case"trace":this.event.trace.push(J);break;case"error":this.event.error.push(J);break;case"stop":this.event.stop.push(J);break}return this}group($,W,J){const Z=new n({...this.config,prefix:""});Z.store=this.store,Z.definitions=this.definitions,Z.getServer=()=>this.server;const X=typeof W==="object",B=(X?J:W)(Z);if(this.decorators=d(this.decorators,Z.decorators),B.event.request.length)this.event.request=[...this.event.request,...B.event.request];if(B.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...B.event.onResponse];return this.model(B.definitions.type),Object.values(Z.routes).forEach(({method:Y,path:D,handler:Q,hooks:z})=>{if(D=(X?"":this.config.prefix)+$+D,X){const G=W,U=z;this.add(Y,D,Q,a(G,{...U,error:!U.error?B.event.error:Array.isArray(U.error)?[...U.error,...B.event.error]:[U.error,...B.event.error]}))}else this.add(Y,D,Q,a(z,{error:B.event.error}),{skipPrefix:!0})}),this}guard($,W){if(!W)return this.event=v0(this.event,$),this.validator={body:$.body,headers:$.headers,params:$.params,query:$.query,response:$.response},this;const J=new n({...this.config,prefix:""});J.store=this.store,J.definitions=this.definitions;const Z=W(J);if(this.decorators=d(this.decorators,J.decorators),Z.event.request.length)this.event.request=[...this.event.request,...Z.event.request];if(Z.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...Z.event.onResponse];return this.model(Z.definitions.type),Object.values(J.routes).forEach(({method:X,path:B,handler:Y,hooks:D})=>{this.add(X,B,Y,a($,{...D,error:!D.error?Z.event.error:Array.isArray(D.error)?[...D.error,...Z.event.error]:[D.error,...Z.event.error]}))}),this}use($){if($ instanceof Promise)return this.lazyLoadModules.push($.then((W)=>{if(typeof W==="function")return W(this);if(typeof W.default==="function")return W.default(this);return this._use(W)}).then((W)=>W.compile())),this;else return this._use($);return this}_use($){if(typeof $==="function"){const X=$(this);if(X instanceof Promise)return this.lazyLoadModules.push(X.then((B)=>{if(B instanceof n){this.compile();for(let{method:Y,path:D,handler:Q,hooks:z}of Object.values(B.routes))this.add(Y,D,Q,a(z,{error:B.event.error}));return B}if(typeof B==="function")return B(this);if(typeof B.default==="function")return B.default(this);return this._use(B)}).then((B)=>B.compile())),this;return X}const{name:W,seed:J}=$.config;$.getServer=()=>this.getServer(),this.headers($.setHeaders);const Z=$.config.scoped;if(Z){if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const B=J!==void 0?A0(W+JSON.stringify(J)):0;if(this.dependencies[W].some(({checksum:Y})=>B===Y))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:B,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:B,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""}))})}if($.model(this.definitions.type),$.error(this.definitions.error),$.macros=[...this.macros,...$.macros],$.onRequest((B)=>{Object.assign(B,this.decorators),Object.assign(B.store,this.store)}),$.event.trace=[...this.event.trace,...$.event.trace],$.config.aot)$.compile();const X=this.mount($.fetch);return this.routes=this.routes.concat(X.routes),this}else{$.reporter=this.reporter;for(let X of $.event.trace)this.trace(X);if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const X=J!==void 0?A0(W+JSON.stringify(J)):0;if(!this.dependencies[W].some(({checksum:Y})=>X===Y))this.macros.push(...$.macros);const B=[];for(let Y=0;Y<this.macros.length;Y++){const D=this.macros[Y];if(B.includes(D.$elysiaChecksum))this.macros.splice(Y,1),Y--;B.push(D.$elysiaChecksum)}}}this.decorate($.decorators),this.state($.store),this.model($.definitions.type),this.error($.definitions.error);for(let{method:X,path:B,handler:Y,hooks:D}of Object.values($.routes))this.add(X,B,Y,a(D,{error:$.event.error}));if(!Z)if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const X=J!==void 0?A0(W+JSON.stringify(J)):0;if(this.dependencies[W].some(({checksum:B})=>X===B))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:X,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:X,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((B)=>B?.$elysia==="derive").map((B)=>({fn:B.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((B)=>B?.$elysia==="resolve").map((B)=>({fn:B.toString(),stack:new Error().stack??""}))}),this.event=v0(this.event,s0($.event),X)}else this.event=v0(this.event,s0($.event));return this}macro($){return $.$elysiaChecksum=A0(JSON.stringify({name:this.config.name,seed:this.config.seed,content:$.toString()})),this.macros.push($),this}mount($,W){if($ instanceof n||typeof $==="function"||$.length===0||$==="/"){const X=typeof $==="function"?$:$ instanceof n?$.compile().fetch:W instanceof n?W.compile().fetch:W,B=async({request:Y,path:D})=>X(new Request(t0(Y.url,D||"/"),Y));return this.all("/",B,{type:"none"}),this.all("/*",B,{type:"none"}),this}const J=$.length;if(W instanceof n)W=W.compile().fetch;const Z=async({request:X,path:B})=>W(new Request(t0(X.url,B.slice(J)||"/"),X));return this.all($,Z,{type:"none"}),this.all($+($.endsWith("/")?"*":"/*"),Z,{type:"none"}),this}get($,W,J){return this.add("GET",$,W,J),this}post($,W,J){return this.add("POST",$,W,J),this}put($,W,J){return this.add("PUT",$,W,J),this}patch($,W,J){return this.add("PATCH",$,W,J),this}delete($,W,J){return this.add("DELETE",$,W,J),this}options($,W,J){return this.add("OPTIONS",$,W,J),this}all($,W,J){return this.add("ALL",$,W,J),this}head($,W,J){return this.add("HEAD",$,W,J),this}connect($,W,J){return this.add("CONNECT",$,W,J),this}ws($,W){const J=W.transformMessage?Array.isArray(W.transformMessage)?W.transformMessage:[W.transformMessage]:void 0;let Z=null;const X=p(W?.body,{models:this.definitions.type}),B=p(W?.response,{models:this.definitions.type}),Y=(D)=>{if(typeof D==="string"){const Q=D?.charCodeAt(0);if(Q===47||Q===123)try{D=JSON.parse(D)}catch{}else if(f0(D))D=+D}if(J?.length)for(let Q=0;Q<J.length;Q++){const z=J[Q](D);if(z!==void 0)D=z}return D};return this.route("$INTERNALWS",$,(D)=>{const{set:Q,path:z,qi:G,headers:U,query:T,params:j}=D;if(Z===null)Z=this.getServer();if(Z?.upgrade(D.request,{headers:typeof W.upgrade==="function"?W.upgrade(D):W.upgrade,data:{validator:B,open(K){W.open?.(new _0(K,D))},message:(K,P)=>{const I=Y(P);if(X?.Check(I)===!1)return void K.send(new R("message",X,I).message);W.message?.(new _0(K,D),I)},drain(K){W.drain?.(new _0(K,D))},close(K,P,I){W.close?.(new _0(K,D),P,I)}}}))return;return Q.status=400,"Expected a websocket connection"},{beforeHandle:W.beforeHandle,transform:W.transform,headers:W.headers,params:W.params,query:W.query}),this}route($,W,J,{config:Z,...X}={config:{allowMeta:!1}}){return this.add($,W,J,X,Z),this}state($,W){switch(typeof $){case"object":return this.store=d(this.store,$),this;case"function":return this.store=$(this.store),this}if(!($ in this.store))this.store[$]=W;return this}decorate($,W){switch(typeof $){case"object":return this.decorators=d(this.decorators,$),this;case"function":return this.decorators=$(this.decorators),this}if(!($ in this.decorators))this.decorators[$]=W;return this}derive($){return $.$elysia="derive",this.onTransform($)}model($,W){switch(typeof $){case"object":return Object.entries($).forEach(([J,Z])=>{if(!(J in this.definitions.type))this.definitions.type[J]=Z}),this;case"function":return this.definitions.type=$(this.definitions.type),this}return this.definitions.type[$]=W,this}mapDerive($){return $.$elysia="derive",this.onTransform($)}affix($,W,J){if(J==="")return this;const Z=["_","-"," "],X=(Q)=>Q[0].toUpperCase()+Q.slice(1),B=$==="prefix"?(Q,z)=>Z.includes(Q.at(-1)??"")?Q+z:Q+X(z):Z.includes(J.at(-1)??"")?(Q,z)=>z+Q:(Q,z)=>z+X(Q),Y=(Q)=>{const z={};switch(Q){case"decorator":for(let G in this.decorators)z[B(J,G)]=this.decorators[G];this.decorators=z;break;case"state":for(let G in this.store)z[B(J,G)]=this.store[G];this.store=z;break;case"model":for(let G in this.definitions.type)z[B(J,G)]=this.definitions.type[G];this.definitions.type=z;break;case"error":for(let G in this.definitions.error)z[B(J,G)]=this.definitions.error[G];this.definitions.error=z;break}},D=Array.isArray(W)?W:[W];for(let Q of D.some((z)=>z==="all")?["decorator","state","model","error"]:D)Y(Q);return this}prefix($,W){return this.affix("prefix",$,W)}suffix($,W){return this.affix("suffix",$,W)}compile(){if(this.fetch=this.config.aot?Y1(this):D1(this),typeof this.server?.reload==="function")this.server.reload({...this.server,fetch:this.fetch});return this}handle=async($)=>this.fetch($);fetch=($)=>{return(this.fetch=this.config.aot?Y1(this):D1(this))($)};handleError=async($,W)=>(this.handleError=this.config.aot?Q1(this):r1(this))($,W);outerErrorHandler=($)=>new Response($.message||$.name||"Error",{status:$?.status??500});listen=($,W)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof $==="string"){if($=+$.trim(),Number.isNaN($))throw new Error("Port must be a numeric value")}const J=this.fetch,Z=typeof $==="object"?{development:!N0,reusePort:!0,...this.config.serve,...$,websocket:{...this.config.websocket,...$1},fetch:J,error:this.outerErrorHandler}:{development:!N0,reusePort:!0,...this.config.serve,websocket:{...this.config.websocket,...$1},port:$,fetch:J,error:this.outerErrorHandler};if(this.server=Bun?.serve(Z),this.event.start.length)for(let X=0;X<this.event.start.length;X++)this.event.start[X](this);if(W)W(this.server);return process.on("beforeExit",()=>{for(let X=0;X<this.event.stop.length;X++)this.event.stop[X](this)}),Promise.all(this.lazyLoadModules).then(()=>{Bun?.gc(!1)}),this};stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server.stop(),this.event.stop.length)for(let $=0;$<this.event.stop.length;$++)this.event.stop[$](this)};get modules(){return Promise.all(this.lazyLoadModules)}}export{q as t,H as mergeObjectArray,a as mergeHook,d as mergeDeep,v as mapResponse,y as mapEarlyResponse,i as mapCompactResponse,p as getSchemaValidator,a0 as getResponseSchemaValidator,N$ as error,n as default,R as ValidationError,q1 as ParseError,o as NotFoundError,U0 as InvalidCookieSignature,k0 as InternalServerError,n as Elysia,m as Cookie};

//# debugId=D722A493737D224664756e2164756e21
